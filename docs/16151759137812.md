# å¦‚ä½•ç”¨Swaggerç”ŸæˆAPIæ–‡æ¡£

Created: Dec 20, 2019 2:12 PM
Created By: Mario Copperfield
Last Edited By: Mario Copperfield
Last Edited Time: Dec 20, 2019 2:13 PM
Status: Archived
Type: ç ”å‘ä¹‹è·¯

> éšç€å‰åç«¯åˆ†ç¦»çš„æ€åŠ¿è¶Šæ¼”è¶Šçƒˆï¼ŒAPIæ–‡æ¡£æ˜¯åç«¯å’Œå‰ç«¯äº¤äº’(æ’•é€¼)çš„ç¥å™¨ï¼Œå¤äººé€šå¸¸åœ¨â€œçº¸ä¸Šâ€å†™å°±ä¸€ç¯‡ç¯‡çš„APIå…«è‚¡ã€‚éšç€è‡ªåŠ¨åŒ–æ—¶ä»£çš„æ¥ä¸´ï¼Œæœ‰äº†Swaggerè¿™æ ·è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£çš„å·¥å…·å­˜åœ¨ï¼Œåç«¯çš„å¼€å‘å“¥å“¥å°±å†ä¹Ÿä¸ç”¨æŒ¥æ±—å¦‚é›¨åœ°ä¹¦å†™APIæ–‡æ¡£äº†ã€‚
å…³äºSwaggerçš„ä»‹ç»ç½‘ä¸Šå·²ç»æ•°ä¸èƒœæ•°äº†ï¼Œæ‰€ä»¥å†ç­é—¨å¼„æ–§çš„ä»‹ç»å°±æœ‰ç‚¹æ— èŠäº†ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜æ˜¯ç›´æ¥ä»‹ç»ä¸€ä¸‹å¿«é€Ÿå®è·µçš„æµç¨‹ï¼Œè‡³äºæ›´é«˜çº§çš„ç©æ³•ï¼Œå°±äº¤ç»™åˆ—ä¸ºçœ‹å®˜è‡ªè¡Œç ”ç©¶äº†ã€‚

## é€šè¿‡ç½‘å€æŸ¥çœ‹API

> è¿™é‡Œè¦å‡è®¾ä½ å·²ç»å»ºå¥½äº†Spring Bootå·¥ç¨‹ï¼Œå¦‚æœæ²¡æœ‰å»ºå¥½ï¼Œå¯ä»¥å»ç½‘ä¸Šæ‰¾æ‰¾åŠæ³•
é‚£ä¹ˆï¼Œé¦–å…ˆå°±æ˜¯è¦åœ¨pomä¸­å¼•å…¥ç›¸å…³çš„ä¾èµ–äº†:

```xml
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>${spring.swagger.version}</version>
</dependency>
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger-ui</artifactId>
    <version>${spring.swagger.version}</version>
</dependency>
```

æœ‰äº†ä¾èµ–ä¹‹åï¼Œæˆ‘ä¼šåœ¨configç›®å½•ä¸‹ï¼Œå»ºç«‹ä¸€ä¸ª`SwaggerConfig`ç±»:

```java
@Configuration
@EnableSwagger2
public class SwaggerConfig {
    
    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                   .apiInfo(apiInfo())
                   .select()  // é€‰æ‹©é‚£äº›è·¯å¾„å’ŒAPIä¼šç”Ÿæˆdocument
                   .apis(RequestHandlerSelectors.basePackage("com.xxxxx.controller"))
                   .paths(PathSelectors.any()) // å¯¹æ‰€æœ‰è·¯å¾„è¿›è¡Œç›‘æ§
                   .build();
    }
    
    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                   .title("Service Title")
                   .description("ç›¸å…³wiki: ")
                   .contact(new Contact("Copperfield", "wiki_url", "xwhfcenter@gmail.com"))
                   .version("v1")
                   .build();
    }
}
```

**è®°ä½æ‰“ä¸Šä¸¤ä¸ªæ³¨è§£: **`@Configuration`å’Œ`@EnableSwagger2`

æ¥ä¸‹æ¥, å°±å¯ä»¥åœ¨`com.xxxxx.controller`ç›®å½•ä¸­åˆ›å»ºç›¸å…³çš„Controllerç±»äº†ï¼Œè¿™é‡Œä»¥å¸¸è§çš„`UserControllerä¸ºä¾‹`ï¼Œå¯¹Userçš„CRUDè¿›è¡ŒAPIæè¿°:

```java
@Api(description = "Userç›¸å…³çš„APIè¯´æ˜")  // è¿™ä¸ªæ˜¯Swaggerçš„æ³¨è§£
@RestController
@RequestMapping(value = Constants.PATH_WITH_VERSION)
@Slf4j
public class UserController {
    
    @ApiOperation(value = "æ–°å¢ç”¨æˆ·(User)")
    @RequestMapping(value = "/users/", method = RequestMethod.POST)
    public GenericResp addUser(@RequestBody User user) {
            ...
    }
    
    @ApiOperation(value = "æŸ¥æ‰¾ç”¨æˆ·(User)")
    @RequestMapping(value = "/users/{id}", method = RequestMethod.GET)
    public GenericResp getUser(@PathVariable Integer id) {
            ...
    }
    
    @ApiOperation(value = "æ›´æ–°ç”¨æˆ·(User)")
    @RequestMapping(value = "/users/{id}", method = RequestMethod.PATCH)
    public GenericResp updateUser(@PathVariable String id, @RequestBody User user) {
            ...
    }

    @ApiOperation(value = "åˆ é™¤ç”¨æˆ·(User)")
    @RequestMapping(value = "/users/{id}", method = RequestMethod.DELETE)
    public GenericResp deleteUser(@PathVariable Integer id) {
            ...
    }
}
```

å¯¹äºUserè¿™ä¸ªä¸šåŠ¡å¯¹è±¡ï¼Œå¯ä»¥è¿™ä¹ˆå®šä¹‰`User.class`:

```java
public class User {
    @ApiModelProperty(value = "User Id", hidden = true)  // è¿™ä¸ªæ˜¯Swaggerçš„æ³¨è§£
    private Integer id;
    @ApiModelProperty(value = "User Name")
    private String userName;
    @ApiModelProperty(value = "Nickname")
    private String nickname;
    @ApiModelProperty(value = "Password")
    private String password;
    @ApiModelProperty(value = "Phone")
    private String phone;
    @ApiModelProperty(value = "Email")
    private String email;
}
```

è¿™ä¹‹åï¼Œrunä¸€ä¸‹SpringApplicationï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€`http://localhost:8080/swagger-ui.html`æŸ¥çœ‹APIäº†ï¼š

UserController

> å¦‚æœServiceå±‚å’ŒDaoå±‚çš„ä»£ç å†™å¥½äº†ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸Šè¿›è¡ŒAPIæµ‹è¯•ä¹ æƒ¯ä½¿ç”¨Postmançš„å¼€å‘ï¼Œå¯ä»¥åœ¨Postmanä¸­é€šè¿‡Import From LinkæŠŠAPIæ–‡æ¡£å¯¼å…¥åˆ°Postmanä¸­

## é€šè¿‡æ–‡ä»¶æŸ¥çœ‹(è¯•éªŒ)

> å› ä¸ºé€šè¿‡ç½‘å€çš„æ–¹å¼ï¼Œéœ€è¦éƒ¨ç½²æœåŠ¡ï¼ŒåˆæœŸæ¥è¯´ä¸å¦‚æ–‡æ¡£ä¼ é˜…èµ·æ¥æ–¹ä¾¿
pomæ–‡ä»¶ä¸­æ–°å¢ä¾èµ–

```xml
<dependency>
    <groupId>io.github.swagger2markup</groupId>
    <artifactId>swagger2markup</artifactId>
    <version>1.3.1</version>
</dependency>
```

è¿™é‡Œæˆ‘æ–°å¢äº†ä¸€ä¸ªæµ‹è¯•ç±»`SwaggerStaticDocTest`ï¼Œä»¥è¾“å‡ºæ‰€æœ‰APIåˆ°ä¸€ä¸ªMarkdownæ–‡ä»¶ä¸ºä¾‹:

```java
@RunWith(SpringRunner.class)
@SpringBootTest
public class SwaggerStaticDocTest {

    /* è¾“å‡ºMarkdownåˆ°å•æ–‡ä»¶ */
    @Test
    public void generateMarkdownDocsToFile() throws Exception {
	
        Swagger2MarkupConfig config = new Swagger2MarkupConfigBuilder()
                                          .withMarkupLanguage(MarkupLanguage.MARKDOWN)
                                          .build();

        Swagger2MarkupConverter.from(new URL("<http://localhost:8080/v2/api-docs>"))
                               .withConfig(config)
                               .build()
                               .toFile(Paths.get("src/docs/markdown/generated/all"));
    }
}
```

è¿è¡Œæµ‹è¯•ï¼Œè·¯å¾„`src/docs/markdown/generated`ä¸‹ç”Ÿæˆæ–‡ä»¶`all.md`

> Markdownçœ‹èµ·æ¥æ²¡æœ‰ç½‘å€çœ‹çš„èˆ’æœï¼Œè€Œä¸”ä¸èƒ½ç”¨æ¥æµ‹è¯•ï¼Œæ‰€ä»¥æœ‰æ¡ä»¶äº†è¯ç ”ç©¶ä¸€ä¸‹æœ‰æ²¡æœ‰é€”å¾„ä¸“é—¨éƒ¨ç½²Swagger APIæ¥å¾—æ›´æœ‰æ•ˆç‡ï¼Œå®˜æ–¹çš„ä»˜è´¹å·¥å…·SwaggerHubï¼Œè‚¯å®šæ˜¯æœ€å¥½ç”¨çš„å§ğŸ¤”